{% extends "base.html" %}
{% block body %}
<style>
  .styled-input {
    width: 300px;
    padding: 10px;
    margin: 10px;
    border: 2px solid #ccc;
    border-radius: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
    width: 95%;
  }

  .styled-input:focus {
    border-color: #6c63ff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    outline: none;
  }

  .styled-input::placeholder {
    color: #bbb;
  }

  .hidden {
    display: none;
  }

  .basehide, .GazShow, .GazoiilShow, .allShow {
    display: none;
  }

  .section-title {
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1.5rem;
    text-align: center;
  }
</style>

<div class="container mt-4">
  <p class="text-center">لطفا یکی از موارد زیر انتخاب کنید</p>
  
  <div class="row border-bottom pb-3 mb-3">
    <div class="col-4">
      <button id="showGas" class="btn btn-outline-danger w-100">گاز</button>
    </div>
    <div class="col-4">
      <button id="showGasoiil" class="btn btn-outline-warning w-100">گازوییل</button>
    </div>
    <div class="col-4">
      <button id="showAll" class="btn btn-outline-secondary w-100">هر دو</button>
    </div>
  </div>

  <form method="post" class="mt-3">
    {% csrf_token %}
    {{ form.as_p }}
    
    <h2 class="section-title GazoiilShow">Gasoline Nozzles</h2>
    <div class="GazoiilShow styled-input GazoiilShow" id="gasoline_nozzle_formset">
      <!-- Forms for Gasoline Nozzles will be added here dynamically -->
    </div>
    
    <h2 class="section-title GazShow">Gas Nozzles</h2>
    <div class="GazShow" id="gas_nozzle_formset">
      <!-- Forms for Gas Nozzles will be added here dynamically -->
    </div>
    
    <h2 class="section-title GazoiilShow">Gasoline Tanks</h2>
    <div class="GazoiilShow" id="gasoline_tank_formset">
      <!-- Forms for Gasoline Tanks will be added here dynamically -->
    </div>
    
    <h2 class="section-title GazShow">Gas Tanks</h2>
    <div class="GazShow" id="gas_tank_formset">
      <!-- Forms for Gas Tanks will be added here dynamically -->
    </div>
    
    <button class="btn btn-success w-100 mb-5" type="submit">تمام و تایید</button>
  </form>
  
 
</div>

<script>
  document.getElementById('showGas').addEventListener('click', function() {
    var allElements = document.querySelectorAll('.basehide, .GazoiilShow, .allShow');
    allElements.forEach(function(element) {
      element.style.display = 'none';
    });
    var gasElements = document.querySelectorAll('.GazShow');
    gasElements.forEach(function(element) {
      element.style.display = 'block';
    });
  });

  document.getElementById('showGasoiil').addEventListener('click', function() {
    var allElements = document.querySelectorAll('.basehide, .GazShow, .allShow');
    allElements.forEach(function(element) {
      element.style.display = 'none';
    });
    var gasoiilElements = document.querySelectorAll('.GazoiilShow');
    gasoiilElements.forEach(function(element) {
      element.style.display = 'block';
    });
  });

  document.getElementById('showAll').addEventListener('click', function() {
    var allElements = document.querySelectorAll('.basehide, .GazShow, .GazoiilShow');
    allElements.forEach(function(element) {
      element.style.display = 'none';
    });
    var allShowElements = document.querySelectorAll('.allShow');
    allShowElements.forEach(function(element) {
      element.style.display = 'block';
    });
  });

  $(document).ready(function() {
    $('#id_gasoline_nozzles').change(function() {
        var count = $(this).val();
        updateNozzleFormset('gasoline', count);
    });

    $('#id_gas_nozzles').change(function() {
        var count = $(this).val();
        updateNozzleFormset('gas', count);
    });

    $('#id_gasoline_tanks').change(function() {
        var count = $(this).val();
        updateTankFormset('gasoline', count);
    });

    $('#id_gas_tanks').change(function() {
        var count = $(this).val();
        updateTankFormset('gas', count);
    });

    function updateNozzleFormset(type, count) {
        var formset = $('#' + type + '_nozzle_formset');
        formset.empty();
        for (var i = 0; i < count; i++) {
            var form = $('<div>').append(
                $('<label>').text('شماره نازل ' + (i + 1) + ' پایان توتالایزر'),
                $('<input>').attr({
                    'type': 'number',
                    'name': type + '_nozzle-' + i + '-totalizer_start',
                    'id': 'id_' + type + '_nozzle-' + i + '-totalizer_start'
                }),
                $('<label>').text('شماره نازل ' + (i + 1) + ' شروع توتالایزر'),
                $('<input>').attr({
                    'type': 'number',
                    'name': type + '_nozzle-' + i + '-totalizer_end',
                    'id': 'id_' + type + '_nozzle-' + i + '-totalizer_end'
                }),
                $('<input>').attr({
                    'type': 'hidden',
                    'name': type + '_nozzle-' + i + '-nozzle_number',
                    'value': (i + 1)
                }),
                $('<input>').attr({
                    'type': 'hidden',
                    'name': type + '_nozzle-' + i + '-station',
                    'value': ''
                })
            );
            formset.append(form);
        }
    }

    function updateTankFormset(type, count) {
        var formset = $('#' + type + '_tank_formset');
        formset.empty();
        for (var i = 0; i < count; i++) {
            var form = $('<div>').append(
                $('<label>').text('شماره مخزن ' + (i + 1) + ' موجودی نهایی'),
                $('<input>').attr({
                    'type': 'number',
                    'name': type + '_tank-' + i + '-final_stock',
                    'id': 'id_' + type + '_tank-' + i + '-final_stock'
                }),
                $('<input>').attr({
                    'type': 'hidden',
                    'name': type + '_tank-' + i + '-tank_number',
                    'value': (i + 1)
                }),
                $('<input>').attr({
                    'type': 'hidden',
                    'name': type + '_tank-' + i + '-station',
                    'value': ''
                })
            );
            formset.append(form);
        }
    }

    function calculateTotals() {
        var gasolineTotal = 0;
        $('#gasoline_nozzle_formset input[id^="id_gasoline_nozzle-"]').each(function(index) {
            var totalizerStart = parseFloat($('#id_gasoline_nozzle-' + index + '-totalizer_start').val()) || 0;
            var totalizerEnd = parseFloat($('#id_gasoline_nozzle-' + index + '-totalizer_end').val()) || 0;
            gasolineTotal += (totalizerEnd - totalizerStart);
        });

        var gasTotal = 0;
        $('#gas_nozzle_formset input[id^="id_gas_nozzle-"]').each(function(index) {
            var totalizerStart = parseFloat($('#id_gas_nozzle-' + index + '-totalizer_start').val()) || 0;
            var totalizerEnd = parseFloat($('#id_gas_nozzle-' + index + '-totalizer_end').val()) || 0;
            gasTotal += (totalizerEnd - totalizerStart);
        });

        $('#gasoline_total').text('مجموع بنزین: ' + gasolineTotal);
        $('#gas_total').text('مجموع گاز: ' + gasTotal);
    }

    // Recalculate totals when input values change
    $(document).on('input', 'input[id^="id_gasoline_nozzle-"], input[id^="id_gas_nozzle-"]', calculateTotals);
});

</script>
{% endblock %}
